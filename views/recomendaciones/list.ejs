<%- include('../includes/head.ejs') %>

<h1 class="title is-large">Estas son tus recomendaciones</h1>
<div class="container">
    <div class="field is-grouped is-grouped-right">
        <a href="/recomendaciones/nueva_recomendacion"><button class="button is-primary">Nueva Recomendación</button></a>
    </div>
    <p>Buscar</p>
    <input class="input is-normal" type="text" placeholder="Buscar"><button class="button is-primary">Buscar</button>
</div>
<div class="container">
    <div class="columns is-multiline">
            <% if (recomendaciones.length > 0) { %>              
                <% for (let r of recomendaciones) { %>
                    <div class="column is-one-quarter">
                    <%- include('card.ejs', {recomendacion: r}) %>
                    </div>
                <% } %>
            <% } else { %>
                <h2 class="title is-large">No hay recomendaciones registradas.</h2>
            <% } %>
    </div>
 </div> 

<div class="field is-grouped is-grouped-right">
    <a href="/recomendaciones/nueva_recomendacion"><button class="button is-primary">Nueva Recomendación</button></a>
</div>

<% if (ultimo_recomendacion != '') { %>
    <p>La ultima recomendacion registrado fue: <%= ultimo_recomendacion %></p>
<% } %>

<script>
    accion_asincrona = () => {
        let valor_busqueda = document.getElementById('buscar').value;
        //función que manda la petición asíncrona
        fetch('/recomendaciones/buscar/' + valor_busqueda, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(result => {
            return result.json(); //Regresa otra promesa
        }).then(data => {
            //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
            console.log(data);
        }).catch(err => {
            console.log(err);
        });
    }
    document.getElementById('buscar').onkeyup = accion_asincrona;
</script>

<%- include('../includes/foot.ejs') %>